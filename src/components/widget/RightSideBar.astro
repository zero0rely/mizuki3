---
import { sidebarLayoutConfig } from "../../config";
import Calendar from "./Calendar.astro";
import SiteStats from "./SiteStats.astro";

// 获取右侧栏组件配置
const rightSidebarComponents = sidebarLayoutConfig.components.filter(
	(component) => {
		// 只显示右侧栏且启用的组件
		return component.enable && component.sidebar === "right";
	},
);

// 按顺序排序组件
rightSidebarComponents.sort((a, b) => a.order - b.order);

// 分离顶部固定和粘性定位的组件
const topComponents = rightSidebarComponents.filter(
	(component) => component.position === "top",
);
const stickyComponents = rightSidebarComponents.filter(
	(component) => component.position === "sticky",
);
---

<div class="right-sidebar" id="right-sidebar">
  <!-- 顶部固定区域 -->
  <div class="sidebar-top">
    {topComponents.map((component, _index) => (
      <div class={`sidebar-component ${component.class || ''}`} 
           style={`animation-delay: ${component.animationDelay || 0}ms; ${component.style || ''}`}>
        {component.type === "site-stats" && <SiteStats />}
        {component.type === "calendar" && <Calendar />}
      </div>
    ))}
  </div>
  
  <!-- 粘性定位区域 -->
  <div class="sidebar-sticky">
    {stickyComponents.map((component, _index) => (
      <div class={`sidebar-component ${component.class || ''}`} 
           style={`animation-delay: ${component.animationDelay || 0}ms; ${component.style || ''}`}>
        {component.type === "site-stats" && <SiteStats />}
        {component.type === "calendar" && <Calendar />}
      </div>
    ))}
  </div>
</div>

<style>
  .right-sidebar {
    display: flex;
    flex-direction: column;
    gap: 16px;
    width: 100%;
    max-width: 300px;
    height: fit-content;
    position: sticky;
    top: 80px;
  }
  
  .sidebar-top {
    display: flex;
    flex-direction: column;
    gap: 16px;
  }
  
  .sidebar-sticky {
    display: flex;
    flex-direction: column;
    gap: 16px;
    position: sticky;
    top: 0;
  }
  
  .sidebar-component {
    opacity: 0;
    transform: translateY(20px);
    animation: fadeInUp 0.5s forwards;
  }
  
  @keyframes fadeInUp {
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }
  
  /* 响应式设计 */
  @media (max-width: 1280px) {
    .right-sidebar {
      max-width: 260px;
    }
  }
  
  @media (max-width: 1024px) {
    .right-sidebar {
      display: none;
    }
  }
</style>
